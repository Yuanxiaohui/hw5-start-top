// Generated by LiveScript 1.3.1
(function(){
  var getnumber, enable_other_button, disable_other_button, show_number, all_button_done, button_click, add_button_click, add_info_click, reset_number, reset_buttons, reset_info, reset, robot, robot_action, is_failed, a_handler, b_handler, c_handler, d_handler, e_handler, bubble_handler;
  getnumber = function(this_id, callback){
    var request;
    request = new XMLHttpRequest();
    request.onreadystatechange = function(){
      if (request.readyState === 4 && request.status === 200) {
        $("#" + this_id)[0].innerHTML = request.responseText;
        enable_other_button(this_id);
        if (all_button_done()) {
          add_info_click();
        }
        return typeof callback == 'function' ? callback() : void 8;
      }
    };
    request.open("GET", "/" + this_id, true);
    return request.send();
  };
  enable_other_button = function(this_id){
    var lis, number, i$, i, results$ = [];
    lis = $(".plank");
    number = $(".number");
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      if (number[i].classList.contains("appear") && this_id !== -1) {
        results$.push(lis[i].style.backgroundColor = 'gray');
      } else {
        results$.push(lis[i].style.backgroundColor = 'rgba(48,63,159,.8)');
      }
    }
    return results$;
  };
  disable_other_button = function(this_id){
    var lis, i$, i, results$ = [];
    lis = $(".plank");
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      if (i !== this_id) {
        results$.push(lis[i].style.backgroundColor = 'gray');
      }
    }
    return results$;
  };
  show_number = function(this_id){
    var number;
    number = $(".number");
    number[this_id].classList.remove("disappear");
    return number[this_id].classList.add("appear");
  };
  all_button_done = function(){
    var number, i$, i;
    number = $(".number");
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      if (number[i].innerHTML === "...") {
        return false;
      }
    }
    return true;
  };
  button_click = function(this_id){
    var buttons, number, lis;
    buttons = $(".letter");
    number = $(".number");
    lis = $(".plank");
    if (number[this_id].style.display === "block") {
      return;
    }
    if (lis[this_id].style.backgroundColor === "gray") {
      return;
    }
    show_number(this_id);
    disable_other_button(this_id);
    getnumber(this_id, buttons[this_id].callback);
  };
  add_button_click = function(){
    var buttons, i$, i, results$ = [];
    buttons = $(".letter");
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      buttons[i].Index = i;
      results$.push(buttons[i].onclick = fn$);
    }
    return results$;
    function fn$(){
      return button_click(this.Index);
    }
  };
  add_info_click = function(){
    var buttons;
    buttons = $(".letter");
    return $('#info-bar')[0].onclick = function(){
      var number, k, i$, i;
      if (all_button_done() !== true) {
        return;
      }
      number = $(".number");
      k = 0;
      for (i$ = 0; i$ <= 4; ++i$) {
        i = i$;
        k += parseInt(number[i].innerHTML);
      }
      return $('#big')[0].innerHTML = k;
    };
  };
  reset_number = function(){
    var number, i$, i, results$ = [];
    number = $('.number');
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      number[i].innerHTML = '...';
      number[i].classList.add("disappear");
      results$.push(number[i].classList.remove("appear"));
    }
    return results$;
  };
  reset_buttons = function(){
    enable_other_button(-1);
    return reset_number();
  };
  reset_info = function(){
    $('#big')[0].innerHTML = "";
    return $('#message')[0].innerHTML = "";
  };
  reset = function(){
    reset_buttons();
    reset_info();
    $(".apb")[0].state = 'enable';
    return robot.state = 'enable';
  };
  robot = function(){
    return $(".apb")[0].onclick = function(){
      var buttons, order, information;
      if (robot.state === 'disable') {
        return;
      }
      robot.state = 'disable';
      buttons = $(".letter");
      order = [0, 1, 2, 3, 4];
      information = ["A", "B", "C", "D", "E"];
      order.sort(function(){
        return 0.5 - Math.random();
      });
      $('#big')[0].innerHTML = information[order[0]] + information[order[1]] + information[order[2]] + information[order[3]] + information[order[4]];
      robot_action(order, 0);
    };
  };
  robot_action = function(order, index){
    var callback;
    if (robot.state === 'disable') {
      if (index === 5) {
        bubble_handler();
        return;
      } else {
        callback = function(){
          return robot_action(order, index + 1);
        };
      }
      switch (order[index]) {
      case 0:
        return a_handler(callback);
      case 1:
        return b_handler(callback);
      case 2:
        return c_handler(callback);
      case 3:
        return d_handler(callback);
      case 4:
        return e_handler(callback);
      }
    }
  };
  window.onload = function(){
    reset();
    robot();
    add_button_click();
    add_info_click();
    return $('#at-plus-container')[0].onmouseleave = reset;
  };
  is_failed = function(){
    return Math.random() > 0.6;
  };
  a_handler = function(callback){
    var buttons, number, lis;
    if (is_failed()) {
      $('#message')[0].innerHTML = '这不是个天大的秘密';
      console.log("A Fail:这不是个天大的秘密");
      return typeof callback == 'function' ? callback() : void 8;
    } else {
      $('#message')[0].innerHTML = '这是个天大的秘密';
      console.log("A Success:这是个天大的秘密");
      buttons = $(".letter");
      number = $(".number");
      lis = $(".plank");
      show_number(0);
      disable_other_button(0);
      return getnumber(0, callback);
    }
  };
  b_handler = function(callback){
    var buttons, number, lis;
    if (is_failed()) {
      $('#message')[0].innerHTML = '我知道';
      console.log("B Fail:我知道");
      return typeof callback == 'function' ? callback() : void 8;
    } else {
      $('#message')[0].innerHTML = '我不知道';
      console.log("B Success:我不知道");
      buttons = $(".letter");
      number = $(".number");
      lis = $(".plank");
      show_number(1);
      disable_other_button(1);
      return getnumber(1, callback);
    }
  };
  c_handler = function(callback){
    var buttons, number, lis;
    if (is_failed()) {
      $('#message')[0].innerHTML = '你知道';
      console.log("C Fail:你知道");
      return typeof callback == 'function' ? callback() : void 8;
    } else {
      $('#message')[0].innerHTML = '你不知道';
      console.log("C Success:你不知道");
      buttons = $(".letter");
      number = $(".number");
      lis = $(".plank");
      show_number(2);
      disable_other_button(2);
      return getnumber(2, callback);
    }
  };
  d_handler = function(callback){
    var buttons, number, lis;
    if (is_failed()) {
      $('#message')[0].innerHTML = '他知道';
      console.log("D Fail:他知道");
      return typeof callback == 'function' ? callback() : void 8;
    } else {
      $('#message')[0].innerHTML = '他不知道';
      console.log("D Success:他不知道");
      buttons = $(".letter");
      number = $(".number");
      lis = $(".plank");
      show_number(3);
      disable_other_button(3);
      return getnumber(3, callback);
    }
  };
  e_handler = function(callback){
    var buttons, number, lis;
    if (is_failed()) {
      $('#message')[0].innerHTML = '不怪';
      console.log("E Fail:不怪");
      return typeof callback == 'function' ? callback() : void 8;
    } else {
      $('#message')[0].innerHTML = '这是个天大的秘密';
      console.log("A Success:这是个天大的秘密");
      buttons = $(".letter");
      number = $(".number");
      lis = $(".plank");
      show_number(4);
      disable_other_button(4);
      return getnumber(4, callback);
    }
  };
  bubble_handler = function(){
    var buttons, number, sum, i$, i;
    buttons = $(".letter");
    number = $(".number");
    sum = 0;
    for (i$ = 0; i$ <= 4; ++i$) {
      i = i$;
      if (number[i].innerHTML !== '...') {
        sum += parseInt(number[i].innerHTML);
      }
    }
    $('#big')[0].innerHTML = sum;
    return $('#message')[0].innerHTML = "楼主异步调用战斗力感人，目测不超过";
  };
}).call(this);
