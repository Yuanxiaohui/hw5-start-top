// Generated by LiveScript 1.3.1
/*when onload: 

	add clickListener for all-little-buttons

	able all buttons

			clickListener:
				send number request to server
					when request ready:
						disable me
						able others
						if all-buttons clicked
							able big-bubble

				set waiting style for me
				disable others

	disable big bubble

	!I DONT HANDLE RESET !
	!REMEMBER TO CHANGE IT!
*/
(function(){
  /*
  HOW TO USE LSP??
  	VAR ->
  	FUNCTION->
  		fname = (arguments) -> //!-> if no return
  			//add code here//
  	GETELEMENT->
  	ADDLISTENER->
  	CALLBACK->
  */
  var setUnvisibleAllUnreads, addClickListenerForAllLittleButtons, setUnvisible, setVisible, getRan, checkAndSet, clickListener, enable, disable, disableBigBubble, bubbleListener, enableBigBubble, setWaitingStyle;
  window.onload = function(){
    addClickListenerForAllLittleButtons();
    setUnvisibleAllUnreads();
    disableBigBubble();
  };
  setUnvisibleAllUnreads = function(){
    var reds, i$, to$, i;
    reds = $('.unread');
    for (i$ = 0, to$ = reds.length - 1; i$ <= to$; ++i$) {
      i = i$;
      setUnvisible(reds[i]);
    }
  };
  addClickListenerForAllLittleButtons = function(){
    var greys, i$, to$, i;
    greys = $('li');
    for (i$ = 0, to$ = greys.length - 1; i$ <= to$; ++i$) {
      i = i$;
      /*do*/
      /*(i) -> 
      	(i) !-> do */
      enable(greys[i]);
    }
  };
  setUnvisible = function(red){
    $(red).css('display', 'none');
  };
  setVisible = function(red){
    $(red).css('display', '');
  };
  getRan = function(red, grey){
    $.get('/', function(data, status){
      $(red).html(data);
      checkAndSet(red, grey);
    });
    /*data = $.ajax({url:"/", success: !->
    	$(red).html(data.responseText)
    	check-and-set(red, grey)
    })*/
    /*xmlhttp = new XMLHttpRequest()
    xmlhttp.onreadystatechange  = !->
    	if xmlhttp.readyState==4 && xmlhttp.status==200
    		$(red).html(xmlhttp.responseText)
    		check-and-set(red, grey)
    xmlhttp.open("GET","/",true)
    xmlhttp.send()*/
  };
  checkAndSet = function(red, grey){
    var greys, checkAll, i$, to$, i, bubble;
    greys = $('li');
    checkAll = true;
    for (i$ = 0, to$ = greys.length - 1; i$ <= to$; ++i$) {
      i = i$;
      if (!$(greys[i]).hasClass('checked')) {
        enable(greys[i]);
      }
      red = greys[i].getElementsByClassName('unread')[0];
      if ($(red).html() === "") {
        checkAll = false;
      }
    }
    $(grey).addClass('checked');
    disable(grey);
    if (checkAll) {
      bubble = $('#info-bar');
      enableBigBubble(bubble);
    }
  };
  clickListener = function(){
    var red, greys, i$, to$, i;
    red = this.getElementsByClassName('unread')[0];
    setWaitingStyle(red);
    getRan(red, this);
    setVisible(red);
    greys = $('li');
    for (i$ = 0, to$ = greys.length - 1; i$ <= to$; ++i$) {
      i = i$;
      disable(greys[i]);
    }
    enable(this);
  };
  enable = function(grey){
    $(grey).css('backgroundColor', 'blue');
    /*$(grey).click(click-listener)*/
    grey.onclick = clickListener;
  };
  disable = function(grey){
    $(grey).css('backgroundColor', 'grey');
    grey.onclick = null;
  };
  disableBigBubble = function(){
    var bubble;
    bubble = $('#info-bar');
    $(bubble).css('backgroundColor', 'grey');
    bubble.onclick = null;
  };
  bubbleListener = function(){
    var greys, sum, i$, to$, i, red;
    greys = $('li');
    sum = 0;
    for (i$ = 0, to$ = greys.length - 1; i$ <= to$; ++i$) {
      i = i$;
      red = greys[i].getElementsByClassName('unread')[0];
      sum += Number(red.innerHTML);
    }
    this.innerHTML = sum;
  };
  enableBigBubble = function(bubble){
    $(bubble).css('backgroundColor', 'blue');
    bubble[0].onclick = bubbleListener;
  };
  setWaitingStyle = function(red){
    $(red).html('...');
  };
}).call(this);
