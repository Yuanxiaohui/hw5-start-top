// Generated by LiveScript 1.3.1
var sum, click_num, Presetting, CreatRandomNumber, GetNum, Resetting;
$(function(){
  Presetting();
  CreatRandomNumber();
});
sum = 0;
click_num = 0;
/*预处理， 创建合法鼠标停留区域， 以及离开区域后的重设*/
Presetting = function(){
  var a_plus;
  a_plus = document.getElementById("button");
  a_plus.onmouseover = function(){
    var area_;
    this.id = "button_hover";
    area_ = document.getElementsByTagName("div")[0];
    area_.onmouseover = function(){
      this.id = "area";
      this.onmouseout = function(){
        var x, y, areax1, areax2, areay1, areay2;
        x = event.clientX;
        y = event.clientY;
        areax1 = this.offsetLeft;
        areax2 = this.offsetLeft + 350;
        areay1 = this.offsetTop;
        areay2 = this.offsetTop + 350;
        if (x >= areax2 || x < areax1 || y < areay1 || y >= areay2) {
          Resetting();
        }
      };
    };
  };
};
/* 初始化所有按钮，并为A~E按钮设置申请随机数的操作 */
CreatRandomNumber = function(){
  var buttons, r_numbers, i$, i, r_sum;
  buttons = document.getElementsByTagName("ul");
  r_numbers = buttons[1].getElementsByTagName("li");
  for (i$ = 0; i$ <= 4; ++i$) {
    i = i$;
    r_numbers[i].canclick = 1;
    r_numbers[i].have_number = 0;
  }
  r_sum = buttons[0].getElementsByTagName("li");
  r_sum[0].canclick = 0;
  for (i$ = 0; i$ <= 4; ++i$) {
    i = i$;
    r_numbers[i].style.background = "#0044BB";
    r_numbers[i].onclick = fn$;
  }
  function fn$(){
    var r, number, i$, l;
    if (this.canclick === 1) {
      click_num++;
      this.have_number = 1;
      r = this.getElementsByTagName("span")[0];
      r.style.display = "inline";
      number = 0;
      r.innerHTML = "...";
      for (i$ = 0; i$ <= 4; ++i$) {
        l = i$;
        r_numbers[l].style.background = "#666666";
        r_numbers[l].canclick = 0;
      }
      GetNum(this, r_numbers);
    }
  }
};
/* 核心步骤，申请随机数并填入小气泡 ，实时检测大气泡的激活条件*/
GetNum = function(itself, allbuttons){
  var r, xmlhttp;
  r = itself.getElementsByTagName("span")[0];
  xmlhttp = null;
  xmlhttp = new XMLHttpRequest();
  if (xmlhttp !== null) {
    xmlhttp.open("get", "/", true);
    xmlhttp.send();
    xmlhttp.onreadystatechange = function(){
      var i$, l, buttons, r_numbers;
      if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
        r.innerHTML = xmlhttp.responseText;
        sum += parseInt(r.innerHTML);
        for (i$ = 0; i$ <= 4; ++i$) {
          l = i$;
          if (allbuttons[l].have_number === 0) {
            allbuttons[l].style.background = "#0044BB";
            allbuttons[l].canclick = 1;
          }
        }
        if (click_num === 5) {
          buttons = document.getElementsByTagName("ul");
          r_numbers = buttons[0].getElementsByTagName("li");
          r_numbers[0].style.background = "#0044BB";
          r_numbers[0].canclick = 1;
          r_numbers[0].onclick = function(){
            if (r_numbers[0].canclick === 1) {
              this.innerHTML = sum;
            }
          };
        }
      }
    };
  }
};
/* 重置 */
Resetting = function(){
  var a_plus, area_, buttons, r_numbers, i$, i, r;
  sum = 0;
  click_num = 0;
  a_plus = document.getElementById("button_hover");
  a_plus.id = "button";
  area_ = document.getElementById("area");
  area_.id = "at-plus-container";
  buttons = document.getElementsByTagName("ul");
  r_numbers = buttons[1].getElementsByTagName("li");
  for (i$ = 0; i$ <= 4; ++i$) {
    i = i$;
    r_numbers[i].canclick = 1;
    r_numbers[i].have_number = 0;
    r_numbers[i].style.background = "#0044BB";
    r = r_numbers[i].getElementsByTagName("span")[0];
    r.style.display = "none";
  }
  r_numbers = buttons[0].getElementsByTagName("li");
  r_numbers[0].style.background = "#666666";
  r_numbers[0].innerHTML = "";
  r_numbers[0].canclick = 0;
};